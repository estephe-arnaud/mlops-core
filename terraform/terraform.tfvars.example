# ============================================================================
# Configuration Terraform pour MLOps Core
# ============================================================================
# 
# INSTRUCTIONS :
# 1. Copier vers terraform.tfvars : cp terraform.tfvars.example terraform.tfvars
# 2. Remplir les valeurs obligatoires (marquées ⚠️)
# 3. ⚠️ Ne jamais commiter terraform.tfvars (contient des secrets)
#
# ============================================================================

# ============================================================================
# ⚠️ CONFIGURATION OBLIGATOIRE
# ============================================================================

# ID du projet GCP
project_id = "your-project-id"

# IPs autorisées pour SSH (récupérer votre IP : curl ifconfig.me)
allowed_ssh_ips = [
  "VOTRE-IP-PUBLIQUE/32",  # Exemple : "123.45.67.89/32"
]

# IPs autorisées pour HTTP/HTTPS (Load Balancer GCP recommandé)
allowed_http_ips = [
  "130.211.0.0/22",  # Plages IP des Load Balancers GCP (globales)
  "35.191.0.0/16",
]

# Image Docker (URI complète depuis Artifact Registry)
docker_image = "europe-west1-docker.pkg.dev/YOUR_PROJECT_ID/mlops-repo/iris-api:latest"

# ============================================================================
# SECRET MANAGER - API Key
# ============================================================================

# Option A : Création via Terraform (recommandé)
# 1. Exporter : export TF_VAR_api_key_value="votre-api-key"
# 2. Configurer :
create_secret_manager_secret = true
secret_manager_api_key_name  = "mlops-api-key"

# Option B : Secret créé manuellement
# create_secret_manager_secret = false
# secret_manager_api_key_name  = "mlops-api-key"

# ============================================================================
# CONFIGURATION OPTIONNELLE
# ============================================================================

# Région et zone GCP
region = "europe-west1"
zone   = "europe-west1-b"

# Nom du bucket (vide = généré automatiquement : {project_id}-ml-models)
bucket_name = ""

# URI MLflow Tracking (vide = gs://{bucket_name}/mlruns/)
mlflow_tracking_uri = ""

# Origines CORS (dev: "*", production: spécifier les domaines)
cors_origins = "*"

# Note: Le service est configuré et activé (démarrage au boot), mais non démarré automatiquement
# Démarrer l'API après déploiement: systemctl start mlops-api

# ============================================================================
# CONFIGURATION AVANCÉE (valeurs par défaut généralement suffisantes)
# ============================================================================

# VM
vm_name      = "iris-api-server"
machine_type = "e2-micro"  # e2-micro (free tier) → e2-standard-2 (production)
vm_image     = "ubuntu-os-cloud/ubuntu-2204-lts"
disk_size_gb = 10

# Réseau
network_name          = "mlops-vpc"
service_account_name  = "mlops-api-sa"
enable_public_ip      = false  # Recommandé avec Load Balancer

# Bucket
force_destroy_bucket = false  # ⚠️ SÉCURITÉ : Protège les données

# Monitoring
enable_monitoring_alerts = true
notification_channels    = []  # Exemple : ["email:admin@example.com"]

# Load Balancer (optionnel, recommandé en production)
enable_load_balancer = false
load_balancer_name  = "mlops-api-lb"
enable_cloud_armor  = false  # Nécessite enable_load_balancer = true

# KMS Chiffrement (optionnel)
enable_kms_encryption = false
# kms_key_name = "projects/PROJECT/locations/LOCATION/keyRings/RING/cryptoKeys/KEY"

# Tags
tags = {
  project     = "mlops"
  environment = "dev"  # dev, staging, production
  managed_by  = "terraform"
}
