# ============================================================================
# Configuration Terraform pour MLOps - Exemple
# ============================================================================
# 
# INSTRUCTIONS :
# 1. Copiez ce fichier vers terraform.tfvars
# 2. Remplissez les valeurs obligatoires (marquÃ©es âš ï¸ OBLIGATOIRE)
# 3. Configurez les options selon vos besoins
# 4. âš ï¸  Ne commitez JAMAIS terraform.tfvars (il contient des informations sensibles)
#
# ============================================================================

# ============================================================================
# CONFIGURATION OBLIGATOIRE
# ============================================================================

# âš ï¸ OBLIGATOIRE : ID du projet GCP
# Le project-id doit Ãªtre crÃ©Ã© manuellement (gcloud projects create)
# Voir docs/SEMAINE_3.md section "3. Configurer GCP" pour les dÃ©tails
project_id = "votre-projet-gcp-id"

# RÃ©gion et zone GCP
region = "europe-west1"
zone   = "europe-west1-b"

# ============================================================================
# CONFIGURATION DU BUCKET GCS
# ============================================================================

# Nom du bucket GCS (optionnel, sera gÃ©nÃ©rÃ© automatiquement si vide)
# Le nom doit Ãªtre unique globalement sur GCP
bucket_name = ""

# âš ï¸ SÃ‰CURITÃ‰ : DÃ©sactivÃ© par dÃ©faut pour protÃ©ger les donnÃ©es
# Si true, permet la suppression du bucket mÃªme s'il contient des objets
force_destroy_bucket = true

# ============================================================================
# CONFIGURATION DE LA VM
# ============================================================================

vm_name      = "iris-api-server"
machine_type = "e2-micro"  # e2-micro est dans le free tier (pour tests)
                            # En production, utilisez au moins e2-standard-2
vm_image     = "ubuntu-os-cloud/ubuntu-2204-lts"
disk_size_gb = 10

# Nom du rÃ©seau VPC
network_name = "mlops-vpc"

# Nom du compte de service
service_account_name = "mlops-api-sa"

# ============================================================================
# CONFIGURATION RÃ‰SEAU - SÃ‰CURITÃ‰ CRITIQUE
# ============================================================================

# IP publique : DÃ©sactivÃ©e par dÃ©faut (recommandÃ©)
# Activez uniquement si nÃ©cessaire et utilisez un Load Balancer en production
enable_public_ip = false

# âš ï¸ OBLIGATOIRE : IPs autorisÃ©es pour SSH (CIDR notation)
# La liste vide par dÃ©faut = deny by default (aucun accÃ¨s SSH)
# Vous DEVEZ configurer cette variable avec vos IPs autorisÃ©es !
#
# Pour connaÃ®tre votre IP publique : curl ifconfig.me
#
# Exemples :
# - Pour une IP spÃ©cifique : ["123.45.67.89/32"]
# - Pour plusieurs IPs : ["123.45.67.89/32", "98.76.54.32/32"]
# - Pour un rÃ©seau d'entreprise : ["10.0.0.0/8"]
#
# âš ï¸  NE JAMAIS utiliser "0.0.0.0/0" en production (permet SSH depuis n'importe oÃ¹) !
allowed_ssh_ips = [
  "VOTRE-IP-PUBLIQUE/32",  # âš ï¸ REMPLACEZ par votre IP publique rÃ©elle (ex: "123.45.67.89/32")
  # RÃ©cupÃ©rer votre IP : curl ifconfig.me
]

# âš ï¸ OBLIGATOIRE : IPs autorisÃ©es pour HTTP/HTTPS (CIDR notation)
# La liste vide par dÃ©faut = deny by default (aucun accÃ¨s HTTP)
# Vous DEVEZ configurer cette variable selon votre architecture !
#
# Option 1 : Si vous utilisez un Load Balancer GCP (RECOMMANDÃ‰ en production)
# Utilisez les plages IP connues des Load Balancers GCP (identiques pour tous les utilisateurs GCP)
allowed_http_ips = [
  "130.211.0.0/22",  # Plage principale des Load Balancers GCP (globale)
  "35.191.0.0/16",   # Plage secondaire des Load Balancers GCP (globale)
]

# Option 2 : Si vous exposez directement la VM (NON RECOMMANDÃ‰ en production)
# allowed_http_ips = [
#   "123.45.67.89/32",  # Votre IP uniquement
# ]
#
# âš ï¸ NE JAMAIS utiliser ["0.0.0.0/0"] en production sans protection (Load Balancer + Cloud Armor) !

# ============================================================================
# CONFIGURATION DU DÃ‰PLOIEMENT DE L'API
# ============================================================================

# Image Docker complÃ¨te pour l'API
# Format : gcr.io/PROJECT-ID/iris-api:latest
#          ou europe-west1-docker.pkg.dev/PROJECT-ID/repo/iris-api:latest
docker_image = "gcr.io/votre-projet-gcp-id/iris-api:latest"

# DÃ©ployer automatiquement l'API au dÃ©marrage de la VM
auto_deploy_api = true

# ============================================================================
# SECRET MANAGER - Gestion de l'API_KEY
# ============================================================================
# 
# Vous avez DEUX options pour gÃ©rer l'API_KEY dans Secret Manager.
# Choisissez celle qui correspond le mieux Ã  votre workflow.
#
# IMPORTANT : L'API_KEY doit Ãªtre gÃ©nÃ©rÃ©e AVANT (voir docs/SEMAINE_3.md section 1.1)
# GÃ©nÃ©ration : API_KEY=$(openssl rand -hex 32)
#
# ----------------------------------------------------------------------------
# OPTION A : CrÃ©ation via Terraform (RecommandÃ©) âœ…
# ----------------------------------------------------------------------------
# 
# 1. Exporter l'API_KEY comme variable d'environnement Terraform :
#    export TF_VAR_api_key_value="votre-api-key-secrete"
#
# 2. Configurer dans terraform.tfvars :
create_secret_manager_secret = true
secret_manager_api_key_name = "mlops-api-key"
# âš ï¸ api_key_value n'est PAS dans terraform.tfvars (vient de TF_VAR_api_key_value)
#
# ----------------------------------------------------------------------------
# OPTION B : CrÃ©ation manuelle ðŸ”§
# ----------------------------------------------------------------------------
#
# 1. CrÃ©er le secret manuellement :
#    echo -n "$API_KEY" | gcloud secrets create mlops-api-key \
#      --data-file=- --replication-policy="automatic" --project=votre-projet-gcp-id
#
# 2. Configurer dans terraform.tfvars :
# secret_manager_api_key_name = "mlops-api-key"
# create_secret_manager_secret = false  # (ou omis, false par dÃ©faut)
#
# ----------------------------------------------------------------------------
# Note : L'accÃ¨s IAM au secret est automatiquement configurÃ© par Terraform
#        si secret_manager_api_key_name est dÃ©fini (dans les deux options).
# ============================================================================

# Nom du secret dans Secret Manager
# secret_manager_api_key_name = "mlops-api-key"

# CrÃ©er le secret via Terraform (Option A)
# Si true, api_key_value doit Ãªtre fourni via TF_VAR_api_key_value (variable d'environnement)
# Si false, le secret doit Ãªtre crÃ©Ã© manuellement (Option B)
# create_secret_manager_secret = false

# âš ï¸ SENSIBLE : Ne JAMAIS mettre api_key_value directement ici !
# Utilisez plutÃ´t : export TF_VAR_api_key_value="votre-cle"
# api_key_value = ""  # Ne pas remplir ici, utiliser TF_VAR_api_key_value

# ============================================================================
# CHIFFREMENT KMS (Key Management Service)
# ============================================================================
# 
# Activer le chiffrement KMS pour le bucket GCS (recommandÃ© en production)
# 
# PrÃ©requis : CrÃ©er la clÃ© KMS avant d'activer cette option
# 
# CrÃ©ation de la clÃ© KMS :
# gcloud kms keyrings create mlops-keyring --location=europe-west1
# gcloud kms keys create mlops-key --location=europe-west1 \
#   --keyring=mlops-keyring --purpose=encryption
#
# Puis configurez :
enable_kms_encryption = false
# kms_key_name = "projects/votre-projet-gcp-id/locations/europe-west1/keyRings/mlops-keyring/cryptoKeys/mlops-key"

# ============================================================================
# LOAD BALANCER ET CLOUD ARMOR
# ============================================================================
# 
# Load Balancer : Point d'entrÃ©e sÃ©curisÃ© pour l'API
# - Masque l'IP de la VM (on peut dÃ©sactiver enable_public_ip)
# - Permet d'ajouter Cloud Armor pour protection DDoS
# - Facilite l'ajout de nouvelles VMs plus tard (scalabilitÃ©)
#
# Voir docs/SEMAINE_3.md section "3. Load Balancer avec Cloud Armor" pour les dÃ©tails
#
# ----------------------------------------------------------------------------
# Configuration recommandÃ©e avec Load Balancer :
# ----------------------------------------------------------------------------
# 1. Activer le Load Balancer
# 2. Activer Cloud Armor (protection DDoS)
# 3. DÃ©sactiver enable_public_ip sur la VM
# 4. Configurer allowed_http_ips avec les plages IP des Load Balancers GCP
#    (dÃ©jÃ  configurÃ© ci-dessus : 130.211.0.0/22, 35.191.0.0/16)
# ============================================================================

# Activer un Load Balancer HTTP(S) pour l'API (recommandÃ© en production)
enable_load_balancer = false
load_balancer_name = "mlops-api-lb"

# Activer Cloud Armor pour protection DDoS (recommandÃ© avec Load Balancer)
# NÃ©cessite enable_load_balancer = true
enable_cloud_armor = false

# ============================================================================
# MONITORING ET ALERTES
# ============================================================================
# 
# Activer les alertes Cloud Monitoring pour la VM
# Alertes configurÃ©es :
# - CPU Ã©levÃ© (> 80%)
# - MÃ©moire Ã©levÃ©e (> 85%)
# - Instance down
#
# ============================================================================

# Activer les alertes Cloud Monitoring
enable_monitoring_alerts = false

# Canaux de notification (emails)
# Format : ["email:admin@example.com", "email:devops@example.com"]
notification_channels = [
  # "email:admin@example.com"
]

# ============================================================================
# TAGS POUR LES RESSOURCES
# ============================================================================

tags = {
  project     = "mlops"
  environment = "dev"  # dev, staging, production
  managed_by  = "terraform"
}
