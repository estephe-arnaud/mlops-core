# ============================================================================
# Configuration Terraform pour MLOps - Exemple
# ============================================================================
# Copiez ce fichier vers terraform.tfvars et remplissez les valeurs
# ⚠️  Ne commitez JAMAIS terraform.tfvars (il contient des informations sensibles)
# ============================================================================

# ID du projet GCP (obligatoire)
project_id = "votre-projet-gcp-id"

# Région et zone GCP
region = "europe-west1"
zone   = "europe-west1-a"

# Nom du bucket GCS (optionnel, sera généré automatiquement si vide)
# Le nom doit être unique globalement sur GCP
bucket_name = ""

# Configuration de la VM
vm_name      = "iris-api-server"
machine_type = "e2-micro" # e2-micro est dans le free tier
vm_image     = "ubuntu-os-cloud/ubuntu-2204-lts"
disk_size_gb = 10

# Nom du réseau VPC
network_name = "mlops-vpc"

# Nom du compte de service
service_account_name = "mlops-api-sa"

# Configuration réseau
# ⚠️ SÉCURITÉ : Désactivé par défaut. Activez uniquement si nécessaire.
# En production, utilisez un Load Balancer plutôt qu'une IP publique directe.
enable_public_ip = false

# IPs autorisées pour SSH (CIDR notation)
# ⚠️  SÉCURITÉ CRITIQUE : Cette variable est OBLIGATOIRE et doit être configurée explicitement !
# La valeur par défaut est une liste vide (deny by default) pour la sécurité.
# 
# Exemples :
# - Pour une IP spécifique : ["123.45.67.89/32"]
# - Pour un réseau d'entreprise : ["10.0.0.0/8"]
# - Pour plusieurs IPs : ["123.45.67.89/32", "98.76.54.32/32"]
#
# ⚠️  NE JAMAIS utiliser "0.0.0.0/0" en production (permet SSH depuis n'importe où) !
allowed_ssh_ips = [
  # "123.45.67.89/32"  # ⚠️  DÉCOMMENTEZ et REMPLACEZ par votre IP publique réelle !
]

# IPs autorisées pour HTTP/HTTPS (CIDR notation)
# ⚠️ SÉCURITÉ CRITIQUE : Liste vide par défaut (deny by default)
# Configurez explicitement avec vos IPs autorisées ou utilisez un Load Balancer
# 
# Exemples :
# - Pour un Load Balancer GCP : ["130.211.0.0/22", "35.191.0.0/16"] (IPs des Load Balancers GCP)
# - Pour des IPs spécifiques : ["123.45.67.89/32", "98.76.54.32/32"]
# - Pour un réseau d'entreprise : ["10.0.0.0/8"]
#
# ⚠️ NE JAMAIS utiliser ["0.0.0.0/0"] en production sans protection (Load Balancer + WAF/Cloud Armor) !
allowed_http_ips = [
  # "123.45.67.89/32"  # ⚠️ DÉCOMMENTEZ et REMPLACEZ par vos IPs autorisées !
]

# Configuration du déploiement de l'API
# Image Docker complète pour l'API (ex: gcr.io/PROJECT-ID/iris-api:latest)
docker_image = "gcr.io/votre-projet-gcp-id/iris-api:latest"

# Nom du secret dans Secret Manager pour l'API_KEY
# Si vide, l'API_KEY doit être fournie via métadonnées VM (non recommandé)
# Créez d'abord le secret avec: gcloud secrets create mlops-api-key --data-file=-
secret_manager_api_key_name = "mlops-api-key"

# Déployer automatiquement l'API au démarrage de la VM
auto_deploy_api = true

# Tags pour les ressources
tags = {
  project     = "mlops"
  environment = "dev"
  managed_by  = "terraform"
}
